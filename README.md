# awesome-works

## 写在前面：

2025年8月4日：ztc1300vs863，8552 与 8554 车，用错了过放标志位，大吨位的过放标志位是 `OR` 之后的变量，而小车不是。:bangbang:

2025年5月&7月：

- zat600v653z #16725-F501车的问题，标准版无法获取当前工况。
- 60吨显示器的电源在刷完程序后会自动关闭，需按下按键面板的电源键。与 zat1300vs763 相同。
- 60z 和 60e 的球形手柄较为特殊，其值的解析目前应该没有死区，吊载平移的开关（method)中，删除右手柄纵向值不为零则 `test := 4;` ，解决平移的意外跳出。
- Codesys 刷写会 `4K retain` 区会擦除，导致 `GPS` 解绑，从而锁车。利用 persistent 变量解决。
- 吊载平移的卷扬速度振荡，目前仅60z和60e，改写卷扬期望速度来自变幅速度，同时修改控制周期为 `32` 和 调整位置差系数 `K_position_rise` 和 `K_position_fall`。
- 根据 60z 的代码封装为库。测试了自定义商店网址的可行性，但需要一个服务器。
- PCAN 高级用法：
  - 采用 symbol 变量直接解释报文，可以不用写 filter。
  - 写 macro 发送变化数字刻度。例如，发送变化的回转角度模拟回转。
  - 利用 panel 切换报文数值，不用再来回修改 message。
- 报文差异统计 智能化搭载协议-外：
  - 平移的报文差异较大，由于旧报文的存在本身不统一。
  - 防摇摆的报文差异无，因 C01 未搭载。
- 利用 python 的 fft 处理塔臂的摆动周期数据，fft 在同工况下的数据同一性非常好。华测手簿，可利用图层细化记录。
- 60e 与 1100e 修改周期组发送数据，避免丢包，充分利用控制器的空间与时隙资源。
  - 基数5，程序的 `interval` 在10-12ms可用；50ms一组、100ms三组、200ms四组、500ms十五组。
  - 基数4，程序的 `interval` 在13-15ms可用；50ms一组、100ms三组、200ms四组、500ms五组。
  - 基数3，程序的 `interval` 在16ms可用；50ms一组、100ms两组、200ms两组、500ms五组。
- `Codesys` 代码注释中的批量日期修正。reg 搜索。`(?<=\(\*)\d{8}(?=.*? by 唐金峰\*\))`
- ztc3500vs863 不搭载平移，未调用平移，`derrick_sub` 中的 `smooth` 所乘的系数是0，应声明赋值为1。补丁到了400-1，60z/e、110e、300g吨。

2025年5月5日：

- zat9000v863 #339车左右防摇摆电流限制为 塔臂的电流。后续再更改。
- 另外一台车出现误刷，由于防摇摆I期 `pid` 累加电流小于零时，控制器 `real_to_uint` 死机。 查明于 @2025年7月1日。
- `real_to_uint` 的 解决办法是， limit/max 限定；或 `subrange` ， 其使用要配合 checkRangeUsinged 和 checkRangeSigned。
- 900吨停止搭载。

2025年4月28日：zat4000vs863-1 #2024车，还存有油门锁定-防摇摆功能的开启方式。高家坤已删除。

~~2025年4月25日 重新修改协议：~~:interrobang:

- 4BB 只发送5个字节，对应吊载平移；增加吊载平移跳出的两个类型。
- 3C0 只发送4个字节，对应辅助防摇摆。
- 4BB 发送条件为卷扬传感器心跳。 3C0，发送条件为回转、卷扬传感器心跳在且参数状态启用。周期 400 ms。
- 上述心跳变量与 237、 238 参数无关，表明传感器必须在，而不是在传感器无数据（未收发或未安装）的非标配情形。
- 8个字节从前往后，当前不发送空字节，可以**临时测试使用或版本迭代更新**。

2025年4月16日：

- :heavy_exclamation_mark:ztc1300vs863 #8552 与 #8554 车，回转编码器防拆代码未写，回转编码器心跳错误不会写为 `TRUE`；
- ztc1300vs863 的卷扬编码器标定程序已经从400-1替换，不兼容原来的19A；
- ztc1300vs863 的回转编码器程序替换，替换且兼容中回传感器的标定；大吨位与 162 相关，写入起始为 324 ，2个字节。
- zat4000vs863-1 中回传感器的标定，与参数 240 相关；写入起始为 480，2个字节。

2025年4月10日：

- zat4000vs863-1 此前测试已测试完毕，代码 retain 变量 real 四字节的数组，高家坤直接注释代码（断电丢失），今日协调修改精度 DINT ，保留三个小数点。
- 已经重新拉回指针引用。:copyright:

2025年4月8日：

- 1300vs763 力限器 1.4 为防拆，测试发现卷扬编码器标定代码异常（混乱），已修改。
- **取力问题未发现原因，控制器为5040D，认为是显示器锁车。**
- 编码器装于 CAN4.

2025年4月1日：zat4000vs863-1 #2023车，防拆特性，当拆除两个编码器，需要修改4号控制器的 237 与 238参数。

## 防摇摆I期 vs II期差异 @2025年：

- 年前130吨，角度 anti_angle 与can总线一致（方向相同），joystick_transform 输出未取负，右转时-期望速度为正，anti实际速度为负。操纵无异常。II期。
- 3月上：700吨，角度anti_angle 取can总线值，未放大10倍，joystick_transform 输出未取负时时，操纵无异常。I期。
- 上周：900吨，角度 anti_angle 与can总线反向（关于360度互补），joystick_transform 输出取负时，操纵无异常。预警弧长反向。


- 3月：900吨待正在测试。改角度 anti_angle 与can总线一致（方向相同），joystick_transform 输出未取负时，操纵反向，右转时向左，anti 速度为负，但期望速度为正（pid 没有抑制，可以回转）。再次改回上周代码，但在弧长输出取符号。

- 400-1 照例I期。

- 130 照例II期。130吨，角度 anti_angle 与can总线一致（方向相同）。

- 防摇摆II期，900吨调试问题：

  - 单次防摇摆结束时，存在历经弧长没有清除的现象。因为不必要的复位。上车没有回转则保持橙色状态灯。

  - 回转漂移时长与回转急停距离两位有效数字，除0外。10.4‘ 屏幕不绘制底盘信息。

